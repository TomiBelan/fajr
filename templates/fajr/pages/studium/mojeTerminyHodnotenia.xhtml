{% extends "layout/studium.xhtml" %}
{% block title %}Moje skúšky{% endblock %}
{% block application_content %}
{% import "macros/decorators.xhtml" as decorators %}
{% import "macros/table.xhtml" as table %}
{% parent %}
{{ legacy_content |safe}}
<hr />
{% set head %}
  {{ table.column("predmet") }}
  {{ table.column("čas") }}
  {{ table.column("dátum") }}
  {{ table.column("miestnosť") }}
  {{ table.column("hodnotiaci") }}
  {{ table.column("počet prihlásených") }}
  {{ table.column("maximálny počet") }}
  {{ table.column("poznámka") }}
  {{ table.column("prihlasovanie") }}
  {{ table.column("odhlasovanie") }}
  {{ table.column("Odhlás") }}
  {{ table.column("známka") }}
{% endset %}

{% macro riadok(row, odhlas, studium, zapisnyList) %}
  {% url link for ['tab': 'TerminyHodnotenia',
                   'studium': studium,
                   'list': zapisnyList,
                   'termin': row.index] %}
  <td><a href="{{ link }}">{{ row.predmetNazov }}</a></td>
  <td>{{ row.cas }}</td>
  <td>{{ row.dat }}</td>
  <td>{{ row.miestnosti }}</td>
  <td>{{ row.hodnotiaci }}</td>
  <td>{{ row.pocetPrihlasenych }}</td>
  <td>{{ row.maxPocet }}</td>
  <td>{{ row.poznamka }}</td>
  <td>{{ row.prihlasovanie }}</td>
  <td>{{ row.odhlasovanie }}</td>
  <td>{{ odhlas|safe }}</td>
  <td>{{ row.znamka }}</td>
{% endmacro %}

{% set body %}
  {% for row in terminyActive %}
    {{ table.row(none, (termin != none) and (row.index == termin)) }}
      {% if row.mozeOdhlasit == 1 %}
        {% set class="terminmozeodhlasit" %}
        {% url action for ['tab': 'OdhlasZoSkusky',
                           'studium': studium, 
                           'list': zapisnyList] %}
        {% set odhlas %}
          <form method="post" action="{{ action }}">
            <div>
              <input type="hidden" name="odhlasIndex" value="{{ row.index }}" />
              <input type="hidden" name="hash" value="{{ row.hashNaOdhlasenie }}"/>
              <button name="submit" type="submit" class="tableButton negative">
                <img src="images/cross.png" alt="" />Odhlás
              </button>
            </div>
          </form>        
        {% endset %}
      {% else %}
        {% set class="terminnemozeodhlasit" %}
        {% set odhlas="nedá sa" %}
      {% endif %}
      {% if row.prihlaseny != 'A' %}
        {% set class="terminodhlaseny" %}
        {% set odhlas="Si odhlásený. Ak chceš, opäť sa prihlás." %}
      {% endif %}
      {{ _self.riadok(row, odhlas, studium, zapisnyList) }}
    {{ table.endrow() }}
  {% endfor %}
{% endset %}

{% set title %}
  <h2>Aktuálne termíny hodnotenia</h2>
{% endset %}

{% set tableHTML %}
{{ decorators.table(none, head, body, none, terminyActive|length == 0) }}
{% endset %}

{{ decorators.collapsible(title, tableHTML, false) }}

{# -- stare terminy #}

{% set body %}
  {% for row in terminyOld %}
    {{ table.row(none, (termin != none) and (row.index == termin)) }}
      {{ _self.riadok(row, "Skúška už bola.", studium, zapisnyList) }}
    {{ table.endrow() }}
  {% endfor %}
{% endset %}

{% set title %}
  <h2>Staré termíny hodnotenia</h2>
{% endset %}

{% set tableHTML %}
{{ decorators.table(none, head, body, none, terminyOld|length == 0) }}
{% endset %}

{{ decorators.collapsible(title, tableHTML, false) }}

{# -- zoznam prihlasenych na termin #}

{% if prihlaseni %}

  {% set head %}
    {{ table.column("Dátum prihlásenia") }}
    {{ table.column("Plné meno") }}
    {{ table.column("Skratka študijného programu") }}
    {{ table.column("Ročník") }}
  {% endset %}

  {% set body %}
    {% for row in prihlaseni %}
      {{ table.row(none, false) }}
        <td>{{ row.datumPrihlas }}</td>
        <td>{{ row.plneMeno }}</td>
        <td>{{ row.skratka }}</td>
        <td>{{ row.rocnik }}</td>
      {{ table.endrow() }}
    {% endfor %}
  {% endset %}

  {% set title %}
    <h2>Zoznam prihlásených na vybratý termín</h2>
  {% endset %}

  {% set tableHTML %}
  {{ decorators.table(none, head, body, none, prihlaseni|length == 0) }}
  {% endset %}

  {{ decorators.collapsible(title, tableHTML, false) }}

{% endif %}

{% endblock %}
